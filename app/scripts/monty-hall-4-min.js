"use strict";var MHgame=function(){};MHgame.prototype.init=function(o,e){this.el=o,this._options=$.extend({},this._defaultOptions,e),this._score={wins:0,games:0,losses:function(){return this.games-this.wins}},this._playStep(this.step_1(),300),this.defineSteps()},MHgame.prototype._defaultOptions={doorCount:3,prizeCount:1,hostDoorCount:1,userDoorCount:1,winThreshhold:1,hostKnowsPrize:!1,simulationMode:!1,stepDelay:100,check:function(){return this.doorCount>=this.hostOpenCount+this.userOpenCount&&this.winThreshold<=this.prizeCount}},MHgame.prototype._buildStage=function(){var o=this;o.doors=[];var e=function(){};e.prototype.hasPrize=!1,e.prototype.userPicked=!1,e.prototype.hostOpened=!1,e.prototype.userOpened=!1,e.prototype.id=0;for(var t=o._getRandUnique(o._options.doorCount,o._options.prizeCount),n=0;n<o._options.doorCount;n++)o.doors[n]=new e,o.doors[n].id=n,t.indexOf(n)>-1&&(o.doors[n].hasPrize=!0);$(o.el).append("<ul class='stage'></ul>"),o.stageElement=$(o.el).find("ul.stage"),console.log(o.stageElement)},MHgame.prototype._renderStage=function(){var o=this;o._options.simulationMode||($(o.stageElement).find("li.door-frame").length<1?o._buildDoors():o._updateDoors())},MHgame.prototype._buildDoors=function(){for(var o=this,e=0;e<o.doors.length;e++){var t=$("<li class='door-frame'><div class='door'></div><div class='prize-container'></div></li>\n\n");o.doors[e].hasPrize&&$(t).addClass("has-prize"),$(o.stageElement).append(t)}},MHgame.prototype._updateDoors=function(){var o=this;o._options.simulationMode||$(o.stageElement).find("li.door-frame").each(function(e,t){o.doors[e].userPicked&&$(this).addClass("picked"),o.doors[e].hostOpened&&$(this).addClass("opened"),o.doors[e].userOpened&&$(this).addClass("opened")})},MHgame.prototype._userPicksDoor=function(){var o=this,e={true:0,false:0};$(o.stageElement).find("li.door-frame").on("click",function(){o.doors[$(this).index()].userPicked=!0,e=_.countBy(o.doors,function(o){return 1==o.userPicked}),e.true>=o._options.userDoorCount&&(console.log("user has finished picking doors"),$(o.stageElement).find("li.door-frame").unbind(),o._renderStage(),window.setTimeout(function(){o.step_3()},1500))})},MHgame.prototype._hostOpensDoor=function(){for(var o=this,e=_.filter(o.doors,function(o){if(0==o.userPicked&&0==o.hasPrize)return o}),t=o._getRandUnique(e.length,o._options.hostDoorCount),n=0;n<t.length;n++)o.doors[e[t[n]].id].hostOpened=!0;console.log("host has opened a door"),console.table(o.doors),o._renderStage(),window.setTimeout(function(){o.step_4()},300)},MHgame.prototype._userOpensDoor=function(){var o=this;$(o.stageElement).find("li.door-frame").on("click",function(){o.doors[$(this).index()].userOpened=!0,console.table(o.doors);var e={true:0,false:0},e=_.countBy(o.doors,function(o){return 1==o.userOpened});console.dir(e),e.true>=o._options.userDoorCount&&(console.log("user has finished opening doors"),console.log("user door count"+o._options.userDoorCount),$(o.stageElement).find("li.door-frame").unbind("click"),o._renderStage(),o.step_5())})},MHgame.prototype._playStep=function(o,e){var t=this,n=t._options.stepDelay;void 0!==e&&(n=e),t._options.simulationMode,window.setTimeout(function(){console.log("localStepDelay: "+n)},n)},MHgame.prototype._scoreTheGame=function(){var o=this;_.filter(o.doors,function(o){if(1==o.hasPrize&&1==o.userOpened)return o}).length>=o._options.winThreshold&&(o._score.wins+=1),o._score.games+=1,console.table(o._score),window.setTimeout(function(){o._reset()},3e3)},MHgame.prototype._reset=function(){var o=this;o.doors=[],o._options.simulationMode||$(o.el).html(""),o.step_1()},MHgame.prototype.step_1=function(){var o=this;console.dir(o),o._buildStage(),o._renderStage(),window.setTimeout(function(){o.step_2()},o._options.stepDelay),console.log("playing step 2")},MHgame.prototype.step_2=function(){this._userPicksDoor(),console.log("playing step 3")},MHgame.prototype.step_3=function(){var o=this;this._hostOpensDoor()},MHgame.prototype.step_4=function(){var o=this;this._userOpensDoor(),console.log("playing step 4")},MHgame.prototype.step_5=function(){this._scoreTheGame(),console.log("playing step 5")},MHgame.prototype.defineSteps=function(){var o=function(o){return{done:!0,thing:o}},e={step1:new o("step 1"),step2:new o("step 2"),step3:new o("step 3")};for(var t in e)e[t];console.log(e)},MHgame.prototype._getRandUnique=function(o,e){for(var t=[];t.length<e;){var n=Math.floor(Math.random()*o);t.indexOf(n)>-1||t.push(n)}return t};